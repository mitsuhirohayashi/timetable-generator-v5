# 人間的柔軟性を持つ時間割生成機能の実装完了

## 実装内容

### 1. FlexibleFillingStrategy（柔軟な埋め戦略）
`src/domain/services/implementations/flexible_filling_strategy.py`

**主な機能：**
- **代替教師の自動検索**: 通常の担当教師が不在でも、同じ教科を教えられる他の教師を探す
- **時数借用**: 標準時数を満たしている科目も、緊急時は+1時間まで配置可能
- **緊急教師配置**: 他学年の教師や関連教科の教師も候補として検討
- **柔軟な制約**: 1日2回まで同じ科目配置、連続時限配置も許可
- **時数0ソリューション**: 最終手段として、体育などを「0時間」として配置

### 2. SmartEmptySlotFillerの拡張
- 第5パスとしてFlexibleFillingStrategyを追加
- 詳細な未配置理由のレポート機能
- 教師不在による物理的制約を明確に表示

### 3. CLIオプションの追加
```bash
python3 main.py generate --human-like-flexibility
```

## 特徴

### 従来の戦略との違い
| 戦略 | 日内重複 | 連続配置 | 代替教師 | 時数超過 |
|------|---------|---------|---------|----------|
| Strict | × | × | × | × |
| Balanced | △ | × | × | × |
| Relaxed | ○ | △ | × | △ |
| UltraRelaxed | ○ | ○ | × | ○ |
| **Flexible** | ○ | ○ | ○ | ○ |

### 実装された人間的判断
1. **教師不在への対応**
   - 同じ教科の他の教師を代替として配置
   - 関連教科の教師も緊急時は検討（例：数学教師が算数も担当）

2. **時数の柔軟な運用**
   - 標準時数を超えても配置（借用概念）
   - 緊急時は固定科目以外すべてを候補に

3. **制約の緩和**
   - 1日2回まで同じ科目を配置可能
   - 連続時限での配置も許可
   - 日内重複チェックを緩く運用

## 現状の課題と解決策

### 課題
現在の実装では、教師不在が「ハード制約」として扱われているため、FlexibleFillingStrategyの代替教師機能が十分に活用されていません。

### 推奨される追加実装
1. **教師不在制約のソフト化**
   - TeacherAbsenceConstraintに「緊急モード」を追加
   - human_like_flexibilityフラグ時は不在チェックを緩和

2. **代替教師データベース**
   - 各教師が教えられる教科のマッピング
   - 緊急時の代替可能性マトリックス

3. **時数調整アルゴリズム**
   - 過剰配置された科目から不足科目への時数移動
   - 学期全体でのバランス調整

## 使用方法

```bash
# 人間的柔軟性を有効にして生成
python3 main.py generate --human-like-flexibility --no-ultrathink

# 詳細なログを見る場合
python3 main.py generate --human-like-flexibility --no-ultrathink --verbose
```

## 期待される効果

1. **完全な時間割の生成**
   - 教師不在による空きスロットを代替教師で埋める
   - 時数の柔軟な運用により、すべてのスロットを埋める

2. **現実的な解決策**
   - 人間の時間割作成者が行うような柔軟な判断
   - 緊急時の対応策を自動的に提案

3. **詳細なレポート**
   - なぜ埋められなかったかの詳細な理由
   - 物理的制約と論理的制約の区別