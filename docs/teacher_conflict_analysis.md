# 教師重複問題の分析レポート

## 問題の概要
生成された時間割に多数の教師重複違反が発生している根本原因を分析した結果、
初期スケジュール（input.csv）自体に既に実質38件の教師重複が存在していることが判明しました。

## 分析結果

### 1. 初期スケジュール（input.csv）の問題
- **実際の教師重複**: 38件
  - 5組合同授業として除外: 15件
  - 交流学級ペアとして除外: 63件
- 例：
  - 寺田先生: 月曜2限に1年2組, 1年3組, 1年7組を同時担当
  - 塚本先生: 月曜4限に1年3組, 2年2組, 2年7組を同時担当
  - 蒲地先生: 水曜5限に1年5組, 2年3組, 2年5組, 2年6組, 3年5組を同時担当（5組合同を含む）

### 2. QA.txtの基本原則
```
教師は同じ時間に複数のクラスを同時に教えることはできません
これは全ての教師・全ての時間帯に適用される絶対的な制約です
```

例外：
- 5組の合同授業（3クラスが同じ場所で合同授業）
- テスト期間中（教師が複数教室を巡回監督）

### 3. 正常な運用パターン
以下は制約違反ではなく、正常な運用として除外すべきパターン：
- **5組合同授業**: 1-5, 2-5, 3-5の3クラス合同授業（15件）
- **交流学級ペア**: 親学級と交流学級の同時授業（63件）
  - 例: 1年1組と1年6組、3年3組と3年6組など
- **テスト期間の巡回**: テスト期間中の複数教室巡回

### 4. 統一ハイブリッド戦略V2の結果
正常な運用パターンを除外した実際の違反数：
- **実際の教師重複**: 39件（初期38件→39件とほぼ変化なし）
  - 5組合同授業として除外: 15件
  - 交流学級ペアとして除外: 86件
- **日内重複**: 28件
- **体育館使用違反**: 3件

### 5. 分析の改善
初回の分析では交流学級ペアを誤って違反として計上していたため、
実際の違反数は当初の報告より大幅に少ないことが判明しました。

## 改善案

### 現状の評価
- 統一ハイブリッド戦略V2は教師重複をほぼ増加させていない（38件→39件）
- 主な問題は初期スケジュール自体にある38件の教師重複
- 交流学級ペアと5組合同授業を正しく処理できれば、戦略は有効

### 改善の方向性

#### 1. 初期スケジュールの38件の教師重複を解消
- 特に問題のある教師（寺田、塚本、蒲地など）の配置を見直し
- 同時に3クラス以上を担当している箇所を修正

#### 2. 日内重複（28件）の解消
- 同じ日に同じ科目が2回配置されないようにアルゴリズムを改善
- 特に3年生の学総（学年総合）の重複が多い

#### 3. 体育館使用違反（3件）の解消
- 体育館使用制約をより厳密に適用
- 交流学級ペアの体育は正常として扱う

## 結論
- 実際の教師重複違反は当初の想定（100件以上）より大幅に少ない
- 正常な運用パターン（5組合同、交流学級ペア）を正しく除外することが重要
- 統一ハイブリッド戦略V2は基本的に有効で、微調整で改善可能